<!--check this for options https://docs.djangoproject.com/en/1.4/obsolete/admin-css/




-->

{% extends "admin/base_site.html" %}
{% load admin_extras %}
{% load static %}
{% load i18n admin_static admin_shortcuts_tags %}

{# django-admin-shortcuts changes these blocks #}

{% block breadcrumbs %}
    {% if authenticated %}
        <div class="admin_shortcuts">
            {% admin_shortcuts %}
        </div>
    {% endif %}
{% endblock %}

{% block extrastyle %}
    <style type="text/css">{% admin_shortcuts_css %}</style>
    {{ block.super }}
    <link rel="stylesheet" type="text/css" href="{% static "admin/css/dashboard.css" %}"/>{% endblock %}


{% block extrahead %}
    {{ block.super }}<title>
    {% block title %}{% endblock %}
</title>
    <script src="https://use.fontawesome.com/eb9894ac79.js"></script>
    <link rel="stylesheet"
          href="https://dl.dropboxusercontent.com/u/64841654/leaflet-awesome-marker/css/leaflet.awesome-markers.css">
    <link rel="stylesheet" href="https://dl.dropboxusercontent.com/u/64841654/leaflet/css/leaflet.css"/>
    <script src="https://dl.dropboxusercontent.com/u/64841654/leaflet/js/leaflet.js"></script>
    <script src="https://dl.dropboxusercontent.com/u/64841654/leaflet-awesome-marker/js/leaflet.awesome-markers.js"></script>
    <style>
        .leaflet-google-layer {
            z-index: 0;
        }

        .leaflet-map-pane {
            z-index: 100;
        }

        html, body {
            width: 100%;
            height: 100%;
        }
    </style>
    {% admin_shortcuts_js %}{% endblock %}

{# end changes #}

{% block coltype %}colM{% endblock %}

{% block bodyclass %}{{ block.super }} dashboard{% endblock %}




{% block content %}
    <div id='content-main'> {% csrf_token %}</div>
    <div style="width:100%; height:750px;" id="map"></div>
    <style type="text/css">
        .legend {
            line-height: 18px;
            color: #555;
            background-color: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: -1px 3px 10px -1px rgba(0, 0, 0, 0.4);
            opacity: 0.9;
        }

        .legend-icon {
            background-image: url(https://dl.dropboxusercontent.com/u/64841654/leaflet-awesome-marker/img/markers-soft.png);
            background-repeat: no-repeat;
            width: 35px;
            height: 46px;
            text-align: center;
            float: left;
        }

        .legend-icon > i {
            color: #fff;
            margin-top: 10px;
            display: inline-block;
            font-size: 14px;
        }

        .legend-item {
            clear: both;
        }

        .legend-text {
            float: left;
            padding-top: 10px;
        }
    </style>
    <script>
        var feature_list = [];
        {% for feats in legends %}
            feature_list.push(
                    {
                        "name": "{{ feats.feature_type }}",
                        "styleclass": "{{ feats.style_class }}",
                        "icon": "{{ feats.icon }}",
                        "color": "{{ feats.color }}"
                    }
            );
        {% endfor %}
    </script>
    <script type='text/javascript'>
        var myMap = L.map('map').setView([18.28263, -65.77458], 16);

        var osm = L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token=pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpandmbXliNDBjZWd2M2x6bDk3c2ZtOTkifQ._QA7i5Mpkd_m30IGElHziw', {
            maxZoom: 18,
            attribution: 'ODM2 Project, Basemap &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, ' +
            '<a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, ' +
            'Imagery &copy; <a href="http://mapbox.com">Mapbox</a>', id: 'mapbox.streets'
        }).addTo(myMap);

        var count = 0;
        {% for site in features|filter_coords %}
            count++;
            var feat_obj = feature_list.filter(
                function( obj ){
                    return obj.name == '{{ site.sampling_feature_type.name }}'
                });
            L.marker([{{ site.featuregeometry|get_lat_lng:'lat' }}, {{ site.featuregeometry|get_lat_lng:'lon' }}], {
                icon: L.AwesomeMarkers.icon({
                    icon: feat_obj[0].icon,
                    prefix: 'fa',
                    markerColor: feat_obj[0].color
                }), title: '{{ site.samplingfeaturename }}'
            }).addTo(myMap).bindPopup(
                    '<p>Sampling Feature: {{ site.samplingfeaturename }}'
                    + '<br>Sampling Feature Code: {{ site.samplingfeaturecode }}'
                    + '<br>Sampling Feature Type: {{ site.sampling_feature_type.name }}'
                    + '<br>Coordinates: [{{ site.featuregeometry|get_lat_lng:'lat' }},{{ site.featuregeometry|get_lat_lng:'lon' }}]</p>'
            );
        {% endfor %}

        var legend = L.control({position: 'bottomright'});
        legend.onAdd = function (myMap) {

            var div = L.DomUtil.create('div', 'info legend');

            // loop through our density intervals and generate a label with a colored square for each interval
            for (var i = 0; i < feature_list.length; i++) {
                div.innerHTML +=
                        '<div class="legend-item">' +
                        '      <div class="legend-icon ' + feature_list[i].styleclass + '">' +
                        '           <i class="fa ' + feature_list[i].icon + '" aria-hidden="true"></i>' +
                        '      </div>' +
                        '      <div class="legend-text">' + feature_list[i].name + '</div>' +
                        '</div>'
            }

            return div;
        };

        legend.addTo(myMap);


        // Basemaps Choices
        basemaps = {
            'OSM': osm
        };

        // Overlay Choices
        overlayMaps = {};

        // Put Control on map
        L.control.layers(basemaps, overlayMaps).addTo(myMap);

    </script>


{% endblock %}